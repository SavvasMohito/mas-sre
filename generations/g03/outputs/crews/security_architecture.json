{
  "raw": "### 9.1. Architectural Security Principles\n\nArchitectural security principles provide the foundational philosophy guiding all security design decisions. These principles ensure a consistent security posture across system components and guide the selection and implementation of controls so that the geo-centric student household vacancy platform remains resilient, privacy-preserving and compliant while usable and scalable.\n\n- **Zero Trust Architecture principles**: Never trust, always verify \u2014 every request (user, service, device) must be authenticated and authorized regardless of network location. This reduces implicit trust of internal networks and prevents lateral movement after compromise.\n- **Defense in Depth**: Apply multiple, independent layers of controls (network, host, application, data, identity) so that the failure of one control does not result in full compromise. Layering supports resilience and progressive detection/containment.\n- **Principle of Least Privilege**: Grant users, services and processes only the minimum permissions required to perform tasks. Minimizing privileges limits blast radius and eases auditability.\n- **Secure by Default / Secure by Design**: Build security into architecture and defaults (secure configurations, hardened images, secure libraries) so safe behavior is the natural behavior for users and operators.\n- **Separation of Duties**: Divide critical responsibilities (e.g., moderation vs role management, payments vs refunds) to reduce insider risk and require collusion for harmful actions.\n- **Fail Secure (Fail Safe)**: Systems should default to a secure state on failure (deny access on policy or system failures, freeze critical actions when validation fails).\n- **Complete Mediation**: Authorize every access to a protected resource (no implicit caching of authorization decisions without re-validation when state changes).\n- **Defense in Depth for Privacy (Privacy-by-Design)**: Minimize collection and retention of PII and location data; employ pseudonymization and data minimization patterns at each layer.\n- **Secure Defaults for External Integrations**: Treat every third-party dependency as untrusted; enforce strong contractual security requirements and protect secrets and traffic to/from them.\n- **Observable and Auditable**: Instrument all security-relevant events (auth, admin, moderation, payments) with structured logs, immutable audit trails and SIEM monitoring for detection and forensics.\n\n---\n\n### 9.2. Component-Level Security Controls\n\n#### Frontend User Interface\n\n**Required Controls:**\n\n- Enforce Content Security Policy (CSP), X-Frame-Options, X-Content-Type-Options, Referrer Policy, and secure SameSite cookies.\n- Protect against XSS, CSRF and clickjacking with input sanitization and CSRF tokens.\n- Enforce client-side validation only as UX convenience; rely on server-side validation for enforcement.\n- Avoid embedding secrets/API keys; use short-lived tokens acquired from backend.\n- Serve assets via CDN with WAF protections and TLS 1.3.\n- Protect saved searches/favourites UI with strict per-user authorization checks.\n\n**Recommended Patterns:**\n\n- SPA served from CDN + WAF with edge security rules.\n- OAuth2/OIDC flows for session management (authorization code + PKCE for public clients).\n- Strict separation of UI and API surface; API calls go to API Gateway.\n- Use safe templating libraries and sanitize map/pop-up content.  \n- Implement offline-safe data stores (IndexedDB) with careful encryption of anything sensitive.\n\n#### Edge Layer (CDN / WAF / API Gateway)\n\n**Required Controls:**\n\n- Global TLS termination with TLS 1.3, HSTS and strong cipher suites.\n- WAF rules for OWASP Top 10 protections, bot management and IP reputation blocking.\n- API Gateway enforcing authentication, rate limits, quotas, and per-API authorization (tier checks).\n- Request/response validation, schema enforcement and size limits at the gateway.\n- IP reputation blocking and geo-restriction support where relevant.\n\n**Recommended Patterns:**\n\n- API Gateway with OAuth2 introspection/JWT validation and per-route policies.\n- Edge caching for public assets; dynamic content routed to backend.\n- Rate limiting (per-API, per-user, per-IP) and dynamic throttling.\n- Use edge WAF + CDN for DDoS mitigation and caching; integrate WAF alerts into SIEM.\n\n#### Application Services\n\n**Required Controls:**\n\n- Centralized authentication and authorization (RBAC/ABAC) enforced per-request.\n- Mutual TLS or service-to-service authentication (mTLS or strong mTLS alternatives) inside the platform.\n- Input validation and output encoding at service boundaries.\n- Secure secrets handling (secrets manager / vault) and parameterized DB queries to prevent injection.\n- Service-level logging with correlation IDs; redact PII in logs.\n- Circuit-breakers, throttling, idempotency for message handling.\n- Hardened container or server images with vulnerability scanning.\n\n**Recommended Patterns:**\n\n- API Gateway in front of microservices; microservices behind a service mesh (mTLS, observability).\n- Policy engine for attribute-based access controls (e.g., OPA/Rego).\n- Messaging via durable queues (SQS/Kafka) with encryption-at-rest and access control.\n- Use multi-tenant aware services with scoped keys for user records and adverts.\n\n#### Data Storage\n\n**Required Controls:**\n\n- Encrypt all data at rest using strong algorithms (TDE for RDBMS + column-level encryption for PII).\n- Row/column-level access controls for PII and adverts metadata.\n- Database access only from application subnets and via least-privileged DB roles.\n- Secure object storage for media with signed short-lived URLs and content scanning (malware, PII detection).\n- Harden backups and snapshots (encrypted, stored in separate account/region, immutable storage where required).\n\n**Recommended Patterns:**\n\n- Encrypted RDBMS with Transparent Data Encryption (TDE) + column encryption for PII.\n- Use search index (Elasticsearch/OpenSearch) in private VPC, pre-processed and stripped of exact coordinates/PII.\n- Object storage (S3/GCS/Azure Blob) with per-object KMS encryption and lifecycle policies.\n- Use Data Access layer that enforces owner scoping and ABAC predicates.\n\n#### External Services\n\n**Required Controls:**\n\n- Store API credentials in secrets manager and rotate regularly.\n- Use minimal privilege scopes for service accounts/APIs.\n- Verify TLS certificates, enable certificate pinning where possible and validate webhook signatures.\n\n**Recommended Patterns:**\n\n- Controlled egress via NAT gateways and allowlists; centralized outbound proxy for HTTP(s) with logging.\n- Use signed webhooks with HMAC verification and replay protections.\n- Integrate third-party SDKs with explicit review and limit scope in CSP.\n\n#### Admin & Moderation\n\n**Required Controls:**\n\n- Admin UI protected by SSO with mandatory MFA for admin/moderator roles.\n- Role separation: distinct moderator and administrator roles, with dual-control for destructive actions.\n- JIT (Just-in-Time) and step-up authentication for sensitive actions.\n- Full audit logging for all admin and moderation actions, immutable storage and SIEM alerting.\n\n**Recommended Patterns:**\n\n- Isolated admin network / bastion hosts and conditional access policies (IP allowlists, client certs).\n- Use privileged access management (PAM) for elevated actions.\n- Workflow-based moderation queue with evidence preservation and versioned actions.\n\n#### Notifications & Messaging\n\n**Required Controls:**\n\n- TLS 1.3 for API/Websocket connections and delivery channels where applicable.\n- Messages encrypted at rest; retention and redaction rules applied for PII.\n- Content scanning and sanitization for message text to remove malware and PII before delivery.\n- Rate limiting and anti-automation controls for outgoing notifications.\n\n**Recommended Patterns:**\n\n- Mediated messaging model (no direct user contact unless verified + step-up).\n- Use queueing system (SQS/Kafka) and worker pools with backpressure handling.\n- Template engines with contextual encoding for email and push (no raw HTML from users).\n\n#### Payments & Billing\n\n**Required Controls:**\n\n- No storage of PAN; use PSP tokenization and maintain PCI-compliant integration patterns.\n- Enforce TLS, certificate validation and strong authentication for payment operations.\n- Logging of payment events with strict access control and separation of logs vs transaction payloads.\n\n**Recommended Patterns:**\n\n- Redirect / hosted payment page or tokenization via client-side PSP SDKs to minimize PCI scope.\n- Server-side verification of payment status via PSP webhooks with signed payloads.\n- Payment gateway integration through isolated environments and role-limited service accounts.\n\n---\n\n### 9.3. Data Protection Strategy\n\n**Data Classification:** Public, Internal, Confidential, Restricted\n\n- Public: Aggregated non-identifying adverts metadata, neighbourhood heatmaps (no PII or exact coords).\n- Internal: System telemetry, anonymized analytics, non-sensitive application metadata.\n- Confidential: User profile PII (name, email, phone when verified), messaging contents, billing metadata (excluding PAN tokens), saved searches/favourites.\n- Restricted: Exact addresses (if stored by consent), payment PAN (should never be stored), verification documents (IDs), and admin audit logs that could be used for abuse or identity theft.\n\n**Encryption Requirements:**\n\n- Data in transit: TLS 1.3 mandatory for all external and internal HTTP(s) endpoints; HSTS for web. Use mutual TLS for service-to-service where practical.\n- Data at rest (databases / object storage):\n  - Use AES-256-GCM for envelope/data key encryption (AES-256 with GCM for authenticated encryption).\n  - Use KMS/HSM-backed Customer Master Keys (CMKs) with envelope encryption for data keys.\n  - Column-level encryption for high-risk fields (e.g., user contact details, identity docs) with AEAD.\n- Passwords:\n  - Store using Argon2id (recommended parameters: memory ~64MB-256MB, iterations >=3, parallelism 1-4 depending on load) or bcrypt with strong parameters if Argon2 not available.\n- Asymmetric crypto:\n  - Use ECDSA or ECDH with curve P-256 or P-384 for signatures and key exchange; RSA-3072+ if RSA used.\n- Key lifetimes & rotation:\n  - Data keys rotated every 90 days; CMKs rotated yearly or per policy.\n  - Enable automatic KMS key rotation and maintain key access logs.\n- Logging & backups:\n  - Ensure audit logs are encrypted with separate keys and stored in append-only or WORM storage.\n\n**Retention Policies:**\n\n- Adverts (active): retain until expiry + configurable grace period (default 90 days) then archive for investigation for a minimal period (e.g., 12 months) before secure deletion unless legal reasons require longer retention.\n- Expired/Deleted adverts: soft-delete immediately; physical deletion or shredding from primary store after retention period. Keep audit records for a longer period (e.g., 2\u20137 years depending on legal/compliance).\n- Messaging: retain for business needs with a default of 180 days for in-app messages, configurable by admin policy; redact/delete on DSAR or upon user deletion subject to moderation evidence preservation needs.\n- Payment metadata: keep transaction metadata for tax and invoicing per local law (typically 7 years for many jurisdictions) but do not store PAN. Store PSP tokens and minimal metadata.\n- Logs & audit trails: security logs retained in SIEM per organizational policy (e.g., 1 year hot storage, 3\u20137 years cold archival) and protected from tampering.\n- Verification documents: retain only as long as necessary for verification, default 12 months, unless required to retain longer by law.\n\n**Handling Procedures:**\n\n- Access:\n  - Enforce RBAC/ABAC for all data access; require least privilege for operators.\n  - Admin access to PII requires MFA and justifications recorded; use break-glass with approvals.\n- Transmission:\n  - All transmissions over TLS 1.3+; use signed authentication tokens (JWTs with short TTLs) and refresh patterns.\n  - For third-party calls, use mTLS where available or strict TLS with certificate validation and allowlist endpoints.\n- Storage:\n  - Use envelope encryption with KMS for objects and database fields. Apply separation of keys for different environments (prod/test).\n  - Search index must not contain raw PII or exact coordinates; include pseudonymized IDs and approximate geohash.\n- Deletion:\n  - Implement deterministic deletion workflows: soft-delete flag, then scheduled purge jobs. Ensure backups retention policies are aligned and that purges also remove data from backups per policy constraints.\n- Data Subject Requests (DSAR):\n  - Maintain ROPA and consent store; implement automated DSAR exports and erasure workflows that cascade to search indexes, caches, third-parties where feasible and log all actions.\n- Pseudonymization & Approximation:\n  - Store approximate location (coarse geohash / grid cell) for all public exposures. Exact coordinates, if ever needed, must be separately encrypted and access-controlled and only accessible with explicit consent and justification.\n- Monitoring & Alerting:\n  - Monitor access patterns to PII and generate alerts for anomalous access (unusual volumes, admin access outside business hours, bulk exports).\n- Test Data:\n  - Prohibit use of live PII in non-prod. Provide synthetic or anonymized datasets for development/testing.\n\n---\n\n### 9.4. Third-Party Integration Security\n\n**Mapbox / Google Maps (Maps API)**\n\n*Security Requirements:*\n\n- Use API keys stored in a secrets manager, not hard-coded.\n- Enforce usage restrictions (HTTP referrer restrictions, domain allowlists).\n- Use TLS for all API calls.\n- Validate and monitor requests/quotas.\n\n*Risk Assessment:* High \u2014 map APIs are needed for geo visualisation; leak of exact coordinates or misuse of keys can reveal sensitive location metadata or run up costs.\n\n*Recommended Controls:*\n\n- Enable domain/referrer and IP restrictions on API keys.\n- Route third-party map calls through a controlled backend or egress proxy to avoid exposing keys to clients (or use short-lived tokens).\n- Limit map responses to coarse location; avoid storing raw tile metadata containing precise coordinates.\n- Monitor API usage, set quotas and alert on anomalies.\n\n**SendGrid / Mailgun or similar (Email Service Provider)**\n\n*Security Requirements:*\n\n- Store API keys in secrets manager with rotation.\n- Use TLS for SMTP/API.\n- Verify webhook signatures and use authenticated webhook endpoints.\n\n*Risk Assessment:* High \u2014 email channel can be abused for spam/phishing and leaks of PII. Misconfigured templates could allow injection/XSS.\n\n*Recommended Controls:*\n\n- Enforce templating that encodes user-provided content.\n- Apply rate limits for triggered emails and digest generation.\n- Monitor bounce/spam rates and reputation; implement DKIM, SPF, DMARC.\n- Validate webhooks via signature verification.\n\n**Firebase Cloud Messaging (FCM) / APNs (Push Providers)**\n\n*Security Requirements:*\n\n- Secure service credentials in vault; use per-environment credentials.\n- Use TLS for push provider connections.\n\n*Risk Assessment:* Medium \u2014 push notifications may leak content if not sanitized and can be abused to spam devices.\n\n*Recommended Controls:*\n\n- Throttle push notification sends and use user opt-in.\n- Avoid sending PII in push payloads; link into the app that requires authentication to view content.\n- Monitor push failures and detect unusual volumes.\n\n**Stripe / Adyen / Payment Gateway**\n\n*Security Requirements:*\n\n- PCI-DSS compliant integration; never store PAN.\n- Use tokenization for cards and TLS for all payment interactions.\n- Validate webhook signatures.\n\n*Risk Assessment:* Critical \u2014 financial data and billing operations; risk of fraud and regulatory exposure.\n\n*Recommended Controls:*\n\n- Use hosted payment pages or client-side tokenization (PSP SDK).\n- Restrict webhooks to endpoint allowlisted IPs and signed payloads.\n- Maintain contractually required assurances (PCI Attestation, SOC reports).\n- Perform reconciliation and fraud monitoring; log payment events in immutable audit logs.\n\n**CDN / WAF Provider (Cloudflare/Akamai/etc.)**\n\n*Security Requirements:*\n\n- Secure account with SSO + MFA for admin roles.\n- Use WAF rulesets, bot mitigation and DDoS protections.\n\n*Risk Assessment:* High \u2014 if compromised, it can affect content integrity and traffic flow.\n\n*Recommended Controls:*\n\n- Enable least-privileged admin roles and IP-restricted dashboard access.\n- Configure WAF rules tuned to application behavior and OWASP protections.\n- Use encryption (TLS), origin attestation (client certs to origin) and private network peering where possible.\n\n**Elasticsearch / OpenSearch (Search Index)**\n\n*Security Requirements:*\n\n- Restrict access to private VPC; require authentication and TLS.\n- Do not store raw PII or exact coordinates in the index.\n\n*Risk Assessment:* High \u2014 search clusters have had high-profile exposures; unprotected clusters leak sensitive data.\n\n*Recommended Controls:*\n\n- Network isolation (VPC), IP allowlists and IAM-based access controls.\n- Enable node-to-node TLS, authentication (e.g., native auth or proxy), encryption at rest.\n- Index only pseudonymized IDs and coarse geohashes; implement scrubber jobs to remove PII.\n\n**ML Moderation Tooling (Third-party / SaaS)**\n\n*Security Requirements:*\n\n- Clear data sharing contract and DPIA for sending content to third-party moderation services.\n- Prefer on-prem or private VPC deployment for sensitive content.\n\n*Risk Assessment:* Medium to High \u2014 content may include PII or sensitive images; sharing increases privacy risk and regulatory obligations.\n\n*Recommended Controls:*\n\n- Use privacy-preserving techniques (hashing, tokenization, on-device or on-prem inference where possible).\n- Log and monitor what content is sent, keep minimal context, and maintain consent/DSAR ability.\n- Contractual safeguards: data processing addendum, breach notification SLAs, deletion policies.\n\n**Identity Provider (SSO / Okta / Azure AD / Auth0)**\n\n*Security Requirements:*\n\n- Use OIDC/OAuth2 and enforce MFA for privileged roles.\n- Configure role/claim mappings and enforce SCIM for provisioning.\n\n*Risk Assessment:* High \u2014 identity provider compromise leads to broad access.\n\n*Recommended Controls:*\n\n- Enforce SSO with short session TTLs and conditional access (IP, device posture).\n- Monitor for suspicious sign-ins, enforce risk-based authentication and device postures.\n- Use just-in-time provisioning with automated de-provisioning on off-boarding.\n\n**Email/Push Webhooks and Notification Providers**\n\n*Security Requirements:*\n\n- Validate signatures for all incoming webhooks.\n- Restrict endpoints to provider IP ranges where available.\n\n*Risk Assessment:* Medium \u2014 unauthenticated webhooks enable spoofing and fraudulent state changes.\n\n*Recommended Controls:*\n\n- Use HMAC signatures, timestamp checks and replay protection.\n- Log webhook deliveries and failures and correlate with payment/notification events.\n\n**Analytics / Timeseries Tools (Datadog / New Relic)**\n\n*Security Requirements:*\n\n- Do not send raw PII to analytics providers.\n- Use secure API keys in secrets manager and limit dashboard access.\n\n*Risk Assessment:* Medium \u2014 leakage of PII into analytics can create compliance risk.\n\n*Recommended Controls:*\n\n- Scrub PII before sending; use pseudonymized identifiers.\n- Restrict analytics dashboards to authorized auditors and admins.\n\n---\n\nConcluding notes (how elements work together):\n\n- Enforce identity-first control at every layer: edge validates token \u2192 gateway enforces RBAC/ABAC policies \u2192 services re-check ownership and apply data scoping. This implements Zero Trust and Complete Mediation.\n- Encryption and key management are foundational: KMS-backed envelope encryption protects PII/keys across storage, backups, and logs.\n- Privacy-by-design is enforced via approximate geolocation (coarse geohashes/grids) at ingestion and strict redaction of exact coordinates from search indexes, logs and map payloads.\n- Monitoring and response: central SIEM and alerting should aggregate auth, admin, moderation, payment and data-access events; automated playbooks (IR-4) drive triage for abuse and DSAR handling.\n- Third-party integrations are treated as untrusted endpoints with contractual, technical and operational mitigations (mTLS, webhooks signatures, tokenization, minimal scopes and rigorous logging).\n- Operational security: include deployment pipelines with SCA/DAST, periodic penetration testing, vulnerability management and privileged access management for administrators.\n\nThis architecture and controls mapping meets the REQ-* mappings and ASVS L2 recommendations and will enable a secure, privacy-preserving student household vacancy platform when implemented under governed SDLC, continuous monitoring, and regular audit/review cycles.",
  "tasks": [
    {
      "name": "design_security_architecture",
      "raw": "### 9.1. Architectural Security Principles\n\nArchitectural security principles provide the foundational philosophy guiding all security design decisions. These principles ensure a consistent security posture across system components and guide the selection and implementation of controls so that the geo-centric student household vacancy platform remains resilient, privacy-preserving and compliant while usable and scalable.\n\n- **Zero Trust Architecture principles**: Never trust, always verify \u2014 every request (user, service, device) must be authenticated and authorized regardless of network location. This reduces implicit trust of internal networks and prevents lateral movement after compromise.\n- **Defense in Depth**: Apply multiple, independent layers of controls (network, host, application, data, identity) so that the failure of one control does not result in full compromise. Layering supports resilience and progressive detection/containment.\n- **Principle of Least Privilege**: Grant users, services and processes only the minimum permissions required to perform tasks. Minimizing privileges limits blast radius and eases auditability.\n- **Secure by Default / Secure by Design**: Build security into architecture and defaults (secure configurations, hardened images, secure libraries) so safe behavior is the natural behavior for users and operators.\n- **Separation of Duties**: Divide critical responsibilities (e.g., moderation vs role management, payments vs refunds) to reduce insider risk and require collusion for harmful actions.\n- **Fail Secure (Fail Safe)**: Systems should default to a secure state on failure (deny access on policy or system failures, freeze critical actions when validation fails).\n- **Complete Mediation**: Authorize every access to a protected resource (no implicit caching of authorization decisions without re-validation when state changes).\n- **Defense in Depth for Privacy (Privacy-by-Design)**: Minimize collection and retention of PII and location data; employ pseudonymization and data minimization patterns at each layer.\n- **Secure Defaults for External Integrations**: Treat every third-party dependency as untrusted; enforce strong contractual security requirements and protect secrets and traffic to/from them.\n- **Observable and Auditable**: Instrument all security-relevant events (auth, admin, moderation, payments) with structured logs, immutable audit trails and SIEM monitoring for detection and forensics.\n\n---\n\n### 9.2. Component-Level Security Controls\n\n#### Frontend User Interface\n\n**Required Controls:**\n\n- Enforce Content Security Policy (CSP), X-Frame-Options, X-Content-Type-Options, Referrer Policy, and secure SameSite cookies.\n- Protect against XSS, CSRF and clickjacking with input sanitization and CSRF tokens.\n- Enforce client-side validation only as UX convenience; rely on server-side validation for enforcement.\n- Avoid embedding secrets/API keys; use short-lived tokens acquired from backend.\n- Serve assets via CDN with WAF protections and TLS 1.3.\n- Protect saved searches/favourites UI with strict per-user authorization checks.\n\n**Recommended Patterns:**\n\n- SPA served from CDN + WAF with edge security rules.\n- OAuth2/OIDC flows for session management (authorization code + PKCE for public clients).\n- Strict separation of UI and API surface; API calls go to API Gateway.\n- Use safe templating libraries and sanitize map/pop-up content.  \n- Implement offline-safe data stores (IndexedDB) with careful encryption of anything sensitive.\n\n#### Edge Layer (CDN / WAF / API Gateway)\n\n**Required Controls:**\n\n- Global TLS termination with TLS 1.3, HSTS and strong cipher suites.\n- WAF rules for OWASP Top 10 protections, bot management and IP reputation blocking.\n- API Gateway enforcing authentication, rate limits, quotas, and per-API authorization (tier checks).\n- Request/response validation, schema enforcement and size limits at the gateway.\n- IP reputation blocking and geo-restriction support where relevant.\n\n**Recommended Patterns:**\n\n- API Gateway with OAuth2 introspection/JWT validation and per-route policies.\n- Edge caching for public assets; dynamic content routed to backend.\n- Rate limiting (per-API, per-user, per-IP) and dynamic throttling.\n- Use edge WAF + CDN for DDoS mitigation and caching; integrate WAF alerts into SIEM.\n\n#### Application Services\n\n**Required Controls:**\n\n- Centralized authentication and authorization (RBAC/ABAC) enforced per-request.\n- Mutual TLS or service-to-service authentication (mTLS or strong mTLS alternatives) inside the platform.\n- Input validation and output encoding at service boundaries.\n- Secure secrets handling (secrets manager / vault) and parameterized DB queries to prevent injection.\n- Service-level logging with correlation IDs; redact PII in logs.\n- Circuit-breakers, throttling, idempotency for message handling.\n- Hardened container or server images with vulnerability scanning.\n\n**Recommended Patterns:**\n\n- API Gateway in front of microservices; microservices behind a service mesh (mTLS, observability).\n- Policy engine for attribute-based access controls (e.g., OPA/Rego).\n- Messaging via durable queues (SQS/Kafka) with encryption-at-rest and access control.\n- Use multi-tenant aware services with scoped keys for user records and adverts.\n\n#### Data Storage\n\n**Required Controls:**\n\n- Encrypt all data at rest using strong algorithms (TDE for RDBMS + column-level encryption for PII).\n- Row/column-level access controls for PII and adverts metadata.\n- Database access only from application subnets and via least-privileged DB roles.\n- Secure object storage for media with signed short-lived URLs and content scanning (malware, PII detection).\n- Harden backups and snapshots (encrypted, stored in separate account/region, immutable storage where required).\n\n**Recommended Patterns:**\n\n- Encrypted RDBMS with Transparent Data Encryption (TDE) + column encryption for PII.\n- Use search index (Elasticsearch/OpenSearch) in private VPC, pre-processed and stripped of exact coordinates/PII.\n- Object storage (S3/GCS/Azure Blob) with per-object KMS encryption and lifecycle policies.\n- Use Data Access layer that enforces owner scoping and ABAC predicates.\n\n#### External Services\n\n**Required Controls:**\n\n- Store API credentials in secrets manager and rotate regularly.\n- Use minimal privilege scopes for service accounts/APIs.\n- Verify TLS certificates, enable certificate pinning where possible and validate webhook signatures.\n\n**Recommended Patterns:**\n\n- Controlled egress via NAT gateways and allowlists; centralized outbound proxy for HTTP(s) with logging.\n- Use signed webhooks with HMAC verification and replay protections.\n- Integrate third-party SDKs with explicit review and limit scope in CSP.\n\n#### Admin & Moderation\n\n**Required Controls:**\n\n- Admin UI protected by SSO with mandatory MFA for admin/moderator roles.\n- Role separation: distinct moderator and administrator roles, with dual-control for destructive actions.\n- JIT (Just-in-Time) and step-up authentication for sensitive actions.\n- Full audit logging for all admin and moderation actions, immutable storage and SIEM alerting.\n\n**Recommended Patterns:**\n\n- Isolated admin network / bastion hosts and conditional access policies (IP allowlists, client certs).\n- Use privileged access management (PAM) for elevated actions.\n- Workflow-based moderation queue with evidence preservation and versioned actions.\n\n#### Notifications & Messaging\n\n**Required Controls:**\n\n- TLS 1.3 for API/Websocket connections and delivery channels where applicable.\n- Messages encrypted at rest; retention and redaction rules applied for PII.\n- Content scanning and sanitization for message text to remove malware and PII before delivery.\n- Rate limiting and anti-automation controls for outgoing notifications.\n\n**Recommended Patterns:**\n\n- Mediated messaging model (no direct user contact unless verified + step-up).\n- Use queueing system (SQS/Kafka) and worker pools with backpressure handling.\n- Template engines with contextual encoding for email and push (no raw HTML from users).\n\n#### Payments & Billing\n\n**Required Controls:**\n\n- No storage of PAN; use PSP tokenization and maintain PCI-compliant integration patterns.\n- Enforce TLS, certificate validation and strong authentication for payment operations.\n- Logging of payment events with strict access control and separation of logs vs transaction payloads.\n\n**Recommended Patterns:**\n\n- Redirect / hosted payment page or tokenization via client-side PSP SDKs to minimize PCI scope.\n- Server-side verification of payment status via PSP webhooks with signed payloads.\n- Payment gateway integration through isolated environments and role-limited service accounts.\n\n---\n\n### 9.3. Data Protection Strategy\n\n**Data Classification:** Public, Internal, Confidential, Restricted\n\n- Public: Aggregated non-identifying adverts metadata, neighbourhood heatmaps (no PII or exact coords).\n- Internal: System telemetry, anonymized analytics, non-sensitive application metadata.\n- Confidential: User profile PII (name, email, phone when verified), messaging contents, billing metadata (excluding PAN tokens), saved searches/favourites.\n- Restricted: Exact addresses (if stored by consent), payment PAN (should never be stored), verification documents (IDs), and admin audit logs that could be used for abuse or identity theft.\n\n**Encryption Requirements:**\n\n- Data in transit: TLS 1.3 mandatory for all external and internal HTTP(s) endpoints; HSTS for web. Use mutual TLS for service-to-service where practical.\n- Data at rest (databases / object storage):\n  - Use AES-256-GCM for envelope/data key encryption (AES-256 with GCM for authenticated encryption).\n  - Use KMS/HSM-backed Customer Master Keys (CMKs) with envelope encryption for data keys.\n  - Column-level encryption for high-risk fields (e.g., user contact details, identity docs) with AEAD.\n- Passwords:\n  - Store using Argon2id (recommended parameters: memory ~64MB-256MB, iterations >=3, parallelism 1-4 depending on load) or bcrypt with strong parameters if Argon2 not available.\n- Asymmetric crypto:\n  - Use ECDSA or ECDH with curve P-256 or P-384 for signatures and key exchange; RSA-3072+ if RSA used.\n- Key lifetimes & rotation:\n  - Data keys rotated every 90 days; CMKs rotated yearly or per policy.\n  - Enable automatic KMS key rotation and maintain key access logs.\n- Logging & backups:\n  - Ensure audit logs are encrypted with separate keys and stored in append-only or WORM storage.\n\n**Retention Policies:**\n\n- Adverts (active): retain until expiry + configurable grace period (default 90 days) then archive for investigation for a minimal period (e.g., 12 months) before secure deletion unless legal reasons require longer retention.\n- Expired/Deleted adverts: soft-delete immediately; physical deletion or shredding from primary store after retention period. Keep audit records for a longer period (e.g., 2\u20137 years depending on legal/compliance).\n- Messaging: retain for business needs with a default of 180 days for in-app messages, configurable by admin policy; redact/delete on DSAR or upon user deletion subject to moderation evidence preservation needs.\n- Payment metadata: keep transaction metadata for tax and invoicing per local law (typically 7 years for many jurisdictions) but do not store PAN. Store PSP tokens and minimal metadata.\n- Logs & audit trails: security logs retained in SIEM per organizational policy (e.g., 1 year hot storage, 3\u20137 years cold archival) and protected from tampering.\n- Verification documents: retain only as long as necessary for verification, default 12 months, unless required to retain longer by law.\n\n**Handling Procedures:**\n\n- Access:\n  - Enforce RBAC/ABAC for all data access; require least privilege for operators.\n  - Admin access to PII requires MFA and justifications recorded; use break-glass with approvals.\n- Transmission:\n  - All transmissions over TLS 1.3+; use signed authentication tokens (JWTs with short TTLs) and refresh patterns.\n  - For third-party calls, use mTLS where available or strict TLS with certificate validation and allowlist endpoints.\n- Storage:\n  - Use envelope encryption with KMS for objects and database fields. Apply separation of keys for different environments (prod/test).\n  - Search index must not contain raw PII or exact coordinates; include pseudonymized IDs and approximate geohash.\n- Deletion:\n  - Implement deterministic deletion workflows: soft-delete flag, then scheduled purge jobs. Ensure backups retention policies are aligned and that purges also remove data from backups per policy constraints.\n- Data Subject Requests (DSAR):\n  - Maintain ROPA and consent store; implement automated DSAR exports and erasure workflows that cascade to search indexes, caches, third-parties where feasible and log all actions.\n- Pseudonymization & Approximation:\n  - Store approximate location (coarse geohash / grid cell) for all public exposures. Exact coordinates, if ever needed, must be separately encrypted and access-controlled and only accessible with explicit consent and justification.\n- Monitoring & Alerting:\n  - Monitor access patterns to PII and generate alerts for anomalous access (unusual volumes, admin access outside business hours, bulk exports).\n- Test Data:\n  - Prohibit use of live PII in non-prod. Provide synthetic or anonymized datasets for development/testing.\n\n---\n\n### 9.4. Third-Party Integration Security\n\n**Mapbox / Google Maps (Maps API)**\n\n*Security Requirements:*\n\n- Use API keys stored in a secrets manager, not hard-coded.\n- Enforce usage restrictions (HTTP referrer restrictions, domain allowlists).\n- Use TLS for all API calls.\n- Validate and monitor requests/quotas.\n\n*Risk Assessment:* High \u2014 map APIs are needed for geo visualisation; leak of exact coordinates or misuse of keys can reveal sensitive location metadata or run up costs.\n\n*Recommended Controls:*\n\n- Enable domain/referrer and IP restrictions on API keys.\n- Route third-party map calls through a controlled backend or egress proxy to avoid exposing keys to clients (or use short-lived tokens).\n- Limit map responses to coarse location; avoid storing raw tile metadata containing precise coordinates.\n- Monitor API usage, set quotas and alert on anomalies.\n\n**SendGrid / Mailgun or similar (Email Service Provider)**\n\n*Security Requirements:*\n\n- Store API keys in secrets manager with rotation.\n- Use TLS for SMTP/API.\n- Verify webhook signatures and use authenticated webhook endpoints.\n\n*Risk Assessment:* High \u2014 email channel can be abused for spam/phishing and leaks of PII. Misconfigured templates could allow injection/XSS.\n\n*Recommended Controls:*\n\n- Enforce templating that encodes user-provided content.\n- Apply rate limits for triggered emails and digest generation.\n- Monitor bounce/spam rates and reputation; implement DKIM, SPF, DMARC.\n- Validate webhooks via signature verification.\n\n**Firebase Cloud Messaging (FCM) / APNs (Push Providers)**\n\n*Security Requirements:*\n\n- Secure service credentials in vault; use per-environment credentials.\n- Use TLS for push provider connections.\n\n*Risk Assessment:* Medium \u2014 push notifications may leak content if not sanitized and can be abused to spam devices.\n\n*Recommended Controls:*\n\n- Throttle push notification sends and use user opt-in.\n- Avoid sending PII in push payloads; link into the app that requires authentication to view content.\n- Monitor push failures and detect unusual volumes.\n\n**Stripe / Adyen / Payment Gateway**\n\n*Security Requirements:*\n\n- PCI-DSS compliant integration; never store PAN.\n- Use tokenization for cards and TLS for all payment interactions.\n- Validate webhook signatures.\n\n*Risk Assessment:* Critical \u2014 financial data and billing operations; risk of fraud and regulatory exposure.\n\n*Recommended Controls:*\n\n- Use hosted payment pages or client-side tokenization (PSP SDK).\n- Restrict webhooks to endpoint allowlisted IPs and signed payloads.\n- Maintain contractually required assurances (PCI Attestation, SOC reports).\n- Perform reconciliation and fraud monitoring; log payment events in immutable audit logs.\n\n**CDN / WAF Provider (Cloudflare/Akamai/etc.)**\n\n*Security Requirements:*\n\n- Secure account with SSO + MFA for admin roles.\n- Use WAF rulesets, bot mitigation and DDoS protections.\n\n*Risk Assessment:* High \u2014 if compromised, it can affect content integrity and traffic flow.\n\n*Recommended Controls:*\n\n- Enable least-privileged admin roles and IP-restricted dashboard access.\n- Configure WAF rules tuned to application behavior and OWASP protections.\n- Use encryption (TLS), origin attestation (client certs to origin) and private network peering where possible.\n\n**Elasticsearch / OpenSearch (Search Index)**\n\n*Security Requirements:*\n\n- Restrict access to private VPC; require authentication and TLS.\n- Do not store raw PII or exact coordinates in the index.\n\n*Risk Assessment:* High \u2014 search clusters have had high-profile exposures; unprotected clusters leak sensitive data.\n\n*Recommended Controls:*\n\n- Network isolation (VPC), IP allowlists and IAM-based access controls.\n- Enable node-to-node TLS, authentication (e.g., native auth or proxy), encryption at rest.\n- Index only pseudonymized IDs and coarse geohashes; implement scrubber jobs to remove PII.\n\n**ML Moderation Tooling (Third-party / SaaS)**\n\n*Security Requirements:*\n\n- Clear data sharing contract and DPIA for sending content to third-party moderation services.\n- Prefer on-prem or private VPC deployment for sensitive content.\n\n*Risk Assessment:* Medium to High \u2014 content may include PII or sensitive images; sharing increases privacy risk and regulatory obligations.\n\n*Recommended Controls:*\n\n- Use privacy-preserving techniques (hashing, tokenization, on-device or on-prem inference where possible).\n- Log and monitor what content is sent, keep minimal context, and maintain consent/DSAR ability.\n- Contractual safeguards: data processing addendum, breach notification SLAs, deletion policies.\n\n**Identity Provider (SSO / Okta / Azure AD / Auth0)**\n\n*Security Requirements:*\n\n- Use OIDC/OAuth2 and enforce MFA for privileged roles.\n- Configure role/claim mappings and enforce SCIM for provisioning.\n\n*Risk Assessment:* High \u2014 identity provider compromise leads to broad access.\n\n*Recommended Controls:*\n\n- Enforce SSO with short session TTLs and conditional access (IP, device posture).\n- Monitor for suspicious sign-ins, enforce risk-based authentication and device postures.\n- Use just-in-time provisioning with automated de-provisioning on off-boarding.\n\n**Email/Push Webhooks and Notification Providers**\n\n*Security Requirements:*\n\n- Validate signatures for all incoming webhooks.\n- Restrict endpoints to provider IP ranges where available.\n\n*Risk Assessment:* Medium \u2014 unauthenticated webhooks enable spoofing and fraudulent state changes.\n\n*Recommended Controls:*\n\n- Use HMAC signatures, timestamp checks and replay protection.\n- Log webhook deliveries and failures and correlate with payment/notification events.\n\n**Analytics / Timeseries Tools (Datadog / New Relic)**\n\n*Security Requirements:*\n\n- Do not send raw PII to analytics providers.\n- Use secure API keys in secrets manager and limit dashboard access.\n\n*Risk Assessment:* Medium \u2014 leakage of PII into analytics can create compliance risk.\n\n*Recommended Controls:*\n\n- Scrub PII before sending; use pseudonymized identifiers.\n- Restrict analytics dashboards to authorized auditors and admins.\n\n---\n\nConcluding notes (how elements work together):\n\n- Enforce identity-first control at every layer: edge validates token \u2192 gateway enforces RBAC/ABAC policies \u2192 services re-check ownership and apply data scoping. This implements Zero Trust and Complete Mediation.\n- Encryption and key management are foundational: KMS-backed envelope encryption protects PII/keys across storage, backups, and logs.\n- Privacy-by-design is enforced via approximate geolocation (coarse geohashes/grids) at ingestion and strict redaction of exact coordinates from search indexes, logs and map payloads.\n- Monitoring and response: central SIEM and alerting should aggregate auth, admin, moderation, payment and data-access events; automated playbooks (IR-4) drive triage for abuse and DSAR handling.\n- Third-party integrations are treated as untrusted endpoints with contractual, technical and operational mitigations (mTLS, webhooks signatures, tokenization, minimal scopes and rigorous logging).\n- Operational security: include deployment pipelines with SCA/DAST, periodic penetration testing, vulnerability management and privileged access management for administrators.\n\nThis architecture and controls mapping meets the REQ-* mappings and ASVS L2 recommendations and will enable a secure, privacy-preserving student household vacancy platform when implemented under governed SDLC, continuous monitoring, and regular audit/review cycles."
    }
  ]
}